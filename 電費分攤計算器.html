<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>é›»è²»åˆ†æ”¤è¨ˆç®—å™¨</title>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container py-4" x-data="feeCalc()">
  <h3 class="mb-3">é›»è²»åˆ†æ”¤è¨ˆç®—å™¨</h3>

  <!-- åŸºæœ¬è¼¸å…¥ -->
  <div class="row mb-3">
    <div class="col-md-4">
      <label class="form-label">ç¸½é›»è²»</label>
      <input type="number" class="form-control" x-model.number="totalFee">
    </div>
    <div class="col-md-4">
      <label class="form-label">åŸºæœ¬è²»/äºº</label>
      <input type="number" class="form-control" x-model.number="baseFee">
    </div>
    <div class="col-md-4">
      <label class="form-label">å¤©æ•¸</label>
      <input type="number" class="form-control" x-model.number="days">
    </div>
  </div>

  <h5>æˆå“¡æ¯æ—¥å†·æ°£ä½¿ç”¨æ™‚æ•¸</h5>
  <template x-for="(m, idx) in members" :key="idx">
    <div class="row mb-2 align-items-center">
      <div class="col-4">
        <input type="text" class="form-control" placeholder="å§“å" x-model="m.name">
      </div>
      <div class="col-4">
        <input type="number" class="form-control" placeholder="å°æ™‚/æ—¥" x-model.number="m.hours">
      </div>
      <div class="col-4 text-end">
        <button class="btn btn-danger btn-sm" @click="removeMember(idx)">ç§»é™¤</button>
      </div>
    </div>
  </template>
  <button class="btn btn-primary mb-3" @click="addMember">æ–°å¢æˆå“¡</button>

  <!-- çµæœè¡¨æ ¼ -->
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>æˆå“¡</th>
        <th>å†·æ°£ä½¿ç”¨(hr/æ—¥)</th>
        <th>æ‡‰ä»˜é‡‘é¡</th>
      </tr>
    </thead>
    <tbody>
      <template x-for="m in members" :key="m.name">
        <tr>
          <td x-text="m.name"></td>
          <td x-text="m.hours"></td>
          <td x-text="calcFee(m).toFixed(0) + ' å…ƒ'"></td>
        </tr>
      </template>
    </tbody>
  </table>

  <div class="alert alert-info">
    <strong>å†·æ°£è²»ç‡ï¼š</strong>
    <span x-text="ratePerHour().toFixed(2) + ' å…ƒ / hr/æ—¥'"></span>
  </div>

  <!-- ç”¢ç”Ÿè¨Šæ¯ -->
  <button class="btn btn-success mb-3" @click="generateMessage">ç”¢ç”Ÿæ–‡å­—è¨Šæ¯</button>

  <div class="alert alert-secondary" style="white-space: pre-line;" x-text="message"></div>
</div>

<script>
function feeCalc() {
  return {
    totalFee: 0,
    baseFee: 500,
    days: 62,
    members: [
      { name: "@é»ƒç¿ç·¯ğŸ‘¶ğŸ»", hours: 8.39 },
      { name: "@Hajikami", hours: 20 },
      { name: "@é«˜æ°‘", hours: 7 },
      { name: "@å®¶æ„·", hours: 0 }
    ],
    message: "",
    addMember() {
      this.members.push({ name: "", hours: 0 });
    },
    removeMember(idx) {
      this.members.splice(idx, 1);
    },
    ratePerHour() {
      let totalBase = this.baseFee * this.members.length;
      let sharePool = this.totalFee - totalBase;
      let totalHours = this.members.reduce((sum, m) => sum + m.hours, 0);
      return totalHours > 0 ? sharePool / totalHours : 0;
    },
    calcFee(member) {
      return this.baseFee + member.hours * this.ratePerHour();
    },
    generateMessage() {
      let rate = this.ratePerHour().toFixed(2);
      let lines = [];
      lines.push(`æœ¬æœŸå…±${this.days}å¤©`);
      lines.push(`é‡åˆ°å°æ•¸ä½éƒ½åœ¨å°æ•¸ç¬¬äºŒä½å››æ¨äº”å…¥`);
      lines.push(`å†·æ°£1hr/æ—¥è²»ç”¨: (${this.totalFee}-${this.baseFee}*${this.members.length})/(${this.members.map(m=>m.hours).join("+")})= ç´„${rate}å…ƒ`);
      lines.push(``);
      lines.push(`æœ¬æœŸé›»è²»(å…±${this.totalFee}å…ƒ)ï¼š`);
      this.members.forEach(m=>{
        let airFee = (m.hours * this.ratePerHour()).toFixed(0);
        let total = this.calcFee(m).toFixed(0);
        lines.push(`${m.name}(${m.hours} hr/æ—¥): ${this.baseFee} + ${airFee} = ${total}å…ƒ`);
      });
      this.message = lines.join("\n");
    }
  }
}
</script>
</body>
</html>
